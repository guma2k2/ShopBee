<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6"> 
<head th:replace = "fragments :: page_head"/>
<body>

    <div th:replace = "navigation :: nav"></div>
     <div>
       <h2>Quản lý loại sản phầm -> [[${pageTitle}]]</h2>
     </div>
      <div class = "container-fluid">
		  <div class="modal fade text-center" id="modalDialog">
			  <div class="modal-dialog">
				  <div class="modal-content">
					  <div class="modal-header">
						  <h4 class="modal-title" id="modalTitle">Warning</h4>
						  <button type="button" class="close" data-dismiss="modal">&times;</button>
					  </div>

					  <div class="modal-body">
						  <span id="modalBody"></span>
					  </div>

					  <div class="modal-footer">
						  <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
					  </div>
				  </div>
			  </div>
		  </div>
     <form th:action = "@{/loaisanpham/save}" method = "POST"
		   enctype="multipart/form-data"
		   th:object = "${loai}"
		   style="max-width: 700px; margin: 0 auto"
		   onsubmit = "return checkUnique(this);">
     <input type="hidden" th:field="*{id}" />
     <div class="border border-secondary rounded p-3">
		<div class="form-group row">
			<label class="col-sm-4 col-form-label">Ten:</label>
			<div class="col-sm-8">
				<input type="text" class="form-control" th:field="*{ten}" required  maxlength="128"  />
			</div>
		</div>
		
		
		<div class="form-group row">
			<label class="col-sm-4 col-form-label">Trạng thái :</label>
			<div class="col-sm-8">
				<input type="checkbox" th:field="*{trangThai}" />
			</div>
		</div>  
		<div class="form-group row">
			<label class="col-sm-4 col-form-label">Ảnh đại diện:</label>
			<div class="col-sm-8">
			     <input type = "hidden" th:field = "*{photo}">
			    <input type = "file" id="fileImage" name = "image" accept = "image/png , image/jpeg"  class = "mb-2"/>
			    <img class = "img-fluid" id = "thumbnail" alt="" th:src="@{${loai.photosImagePath}}">
			</div>
		</div>  
        <div class = "addNv text-center">
           <input type ="submit" class = "btn btn-primary" value = "Save" />
           <input type="button" class = "btn btn-secondary" value = "Cancel" id = "buttonCancel"/>
        </div>
     </div>
     </form>
    </div>
<script th:src = "@{/js/common_form.js}"></script>
<script type="text/javascript">
   moduleURL = "[[@{/loaisanpham}]]";

   function checkUnique(form){
       url = "[[@{/loaisanpham/checkUnique}]]";
       loaiId = $("#id").val();
       tenLoai = $("#ten").val();
       csrfValue = $("input[name = '_csrf']").val();
       params = { id : loaiId , ten : tenLoai , _csrf : csrfValue};
       $.post(url , params, function(res) {
            if(res == "SUCCESSFUL"){
               form.submit();
            }else if(res == "DUPDICATED"){
               showModalDialog("Error" , "Vui lòng tên khác !!");
            }else{
                showModalDialog("Error" , "Error from server");
            }
       }).fail(function(){
		   showModalDialog("Error" , "Could not connect to the server" );
	   });
	   return false ;
   }
   function showModalDialog(title , message){
	   $("#modalTitle").text(title);
	   $("#modalBody").text(message);
	   $("#modalDialog").modal();

   }
</script>
</body>
</html>